{"version":3,"file":"dict-parser.js","sourceRoot":"","sources":["../src/dict-parser.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from 'path'\r\nimport { ILooseObject } from './collections/collection'\r\nimport { MessageGenerator, JsonHelper, getDefinitions, getWords } from './util'\r\nimport { AsciiChars, MsgView, MsgParser, ElasticBuffer, AsciiParser, AsciiView, FiXmlParser, FixmlEncoder } from './buffer'\r\nimport { ReadStream } from 'fs'\r\nimport { ISessionDescription, AsciiMsgTransmitter, StringDuplex, MsgPayload } from './transport'\r\nimport { EnumCompiler, MsgCompiler, ICompilerSettings, FixDefinitions } from './dictionary'\r\nimport { MsgType } from './types/enum'\r\nimport { JsFixWinstonLogFactory, JsFixConfig, WinstonLogger } from './config'\r\nimport * as requestPromise from 'request-promise'\r\nimport { BusinessRejectReason, IBusinessMessageReject } from './types/FIXML50SP2'\r\n\r\nasync function testEncodeDecode (): Promise<any> {\r\n  const msgType: string = 'W'\r\n  const root: string = path.join(__dirname, '../')\r\n  const sessionDescription: ISessionDescription = require('../data/session/test-initiator.json')\r\n  const definitions = await getDefinitions(path.join(root, sessionDescription.application.dictionary))\r\n  const jh: JsonHelper = new JsonHelper(definitions)\r\n  const msg: ILooseObject = jh.fromJson(path.join(root, 'data/examples/FIXML/cme/tc/Initial Single Side Submission/fix.xml'), msgType)\r\n  const config = new JsFixConfig(null, definitions, sessionDescription, AsciiChars.Pipe)\r\n  const session: AsciiMsgTransmitter = new AsciiMsgTransmitter(config)\r\n  const payload: MsgPayload = new MsgPayload(msgType, msg)\r\n  const encoderStream = session.encodeStream\r\n  encoderStream.write(payload)\r\n  session.encodeMessage(msgType, msg)\r\n  const parser: MsgParser = new AsciiParser(definitions, encoderStream, AsciiChars.Pipe)\r\n  const fix: string = session.buffer.toString()\r\n  console.log(fix)\r\n  return new Promise(async (resolve, reject) => {\r\n    parser.on('msg', (msgType: string, view: AsciiView) => {\r\n      resolve(view.toObject())\r\n    })\r\n    parser.on('error', (e: Error) => {\r\n      reject(e)\r\n    })\r\n  })\r\n}\r\n\r\nasync function testGenerator (): Promise<any> {\r\n  const root: string = path.join(__dirname, '../')\r\n  const sessionDescription: ISessionDescription = require('../data/session/test-initiator.json')\r\n  const definitions = await getDefinitions('C:/Users/Stephen/dev/ts/jsfix/data/fix_repo/FIX.4.4/Base')\r\n  const lipsum: string[] = await getWords(path.join(root, 'data/examples/lipsum.txt'))\r\n  const generator: MessageGenerator = new MessageGenerator(lipsum, definitions)\r\n  const msgType: string = MsgType.NewOrderSingle\r\n  const example: ILooseObject = generator.generate(msgType)\r\n  console.log(JSON.stringify(example, null, 4))\r\n  const config = new JsFixConfig(null, definitions, sessionDescription, AsciiChars.Pipe)\r\n  const session: AsciiMsgTransmitter = new AsciiMsgTransmitter(config)\r\n  session.encodeMessage(msgType, example)\r\n  const fix: string = session.buffer.toString()\r\n  const encoderStream = session.encodeStream\r\n  const payload: MsgPayload = new MsgPayload(msgType, example)\r\n  encoderStream.write(payload)\r\n  const parser: MsgParser = new AsciiParser(definitions, encoderStream, AsciiChars.Pipe)\r\n  parser.on('msg', (mt: string, view: MsgView) => {\r\n    console.log(view.toString())\r\n  })\r\n  console.log(fix)\r\n}\r\n\r\n/*\r\nfix.xml\r\nClearing System Confirms Allocation to Executing Firm.xml\r\nClearing System Confirms Allocation to CME Executing Firm_Cross-exchange.xml\r\nClearing System Confirms Completed Reversal to Executing Firm.xml\r\nClearing System Notifies Allocation to the Claiming Firm.xml\r\nfix.xml\r\nClearing System Notifies Claiming Firm of Completed Reversal.xml\r\nClearing System Notifies Executing Firm of Alleged Reversal.xml\r\nExecuting Firm Un-completes Group-Average_Price.xml\r\nExecuting Firm Marks a Trade for Give-up.xml\r\n */\r\nasync function repository (): Promise<any> {\r\n  const root: string = path.join(__dirname, '../')\r\n  const definitions: FixDefinitions = await getDefinitions('repofixml')\r\n  // cme/alloc/Clearing System Notifies Allocation to the Claiming Firm - Cross-Exchange\r\n  // const file: string = path.join(root,'data/examples/FIXML/cme/alloc/Claiming Firm Requests Sub-allocation with Allocation Instructions/')\r\n  // const file: string = path.join(root,'data/examples/FIXML/cme/md/settle')\r\n  // const file: string = path.join(root, 'data/examples/FIXML/cme/alloc/Clearing System Notifies Allocation to the Claiming Firm - Cross-Exchange/')\r\n  const file: string = path.join(root,'data/examples/FIXML/cme/tc/Delivery Fixed Commodity Swap/')\r\n  // const file: string = path.join(root, 'data/examples/FIXML/cme/tc/Trading Firm Continued Subscription')\r\n  // const file: string = path.join(root,'data/examples/FIXML/cme/md/futures')\r\n  // const file: string = path.join(root, 'data/examples/FIXML/cme/tc/Delivery Fixed Commodity Swap')\r\n  // const file: string = path.join(root, 'data/examples/FIXML/cme/tc/Initial Single Side Submission/')\r\n  // const file: string = path.join(root, 'data/examples/FIXML/cme/tc/Accepted Unmatched')\r\n  // const file: string = path.join(root, 'data/examples/FIXML/cme/tc/Trading Firm Continued Subscription/')\r\n  // const file: string = path.join(root, 'data/examples/FIXML/om/nso/')\r\n  // const file: string = path.join(root, 'data/examples/FIXML/om/er/')\r\n  const so = definitions.message.get('ExecutionReport')\r\n  const t855 = definitions.simple.get('SecondaryTrdType')\r\n\r\n  const reject = {\r\n    Text: `no response`,\r\n    BusinessRejectReason: BusinessRejectReason.ApplicationNotAvailable\r\n  } as IBusinessMessageReject\r\n  const fe = new FixmlEncoder(new ElasticBuffer(), definitions)\r\n  fe.encode(reject, 'BusinessMessageReject')\r\n  const fixml: string = fe.buffer.toString()\r\n  // console.log(fixml)\r\n  const jh: JsonHelper = new JsonHelper(definitions)\r\n  const fs: any = require('fs')\r\n  let readStream: ReadStream = fs.createReadStream(`${file}/fix.xml`)\r\n  const sessionDescription: ISessionDescription = require('../data/session/test-initiator.json')\r\n  const config = new JsFixConfig(null, definitions, sessionDescription, AsciiChars.Pipe)\r\n  const xmlParser: MsgParser = new FiXmlParser(config, readStream)\r\n  xmlParser.on('batch', (msgType: string, v: MsgView) => {\r\n    console.log(`received message ${msgType}`)\r\n    const o: ILooseObject = v.toObject()\r\n    console.log(JSON.stringify(o, null, 4))\r\n    const fe = new FixmlEncoder(new ElasticBuffer(), definitions)\r\n    fe.encode(o, msgType)\r\n    const fixml: string = fe.buffer.toString()\r\n    console.log(fixml)\r\n    console.log(v.toString())\r\n  })\r\n  xmlParser.on('msg', (msgType: string, v: MsgView) => {\r\n    console.log(`received message ${msgType}`)\r\n    const o: ILooseObject = v.toObject()\r\n    console.log(JSON.stringify(o, null, 4))\r\n    console.log(v.toString())\r\n    const fe = new FixmlEncoder(new ElasticBuffer(), definitions)\r\n    fe.encode(o, msgType)\r\n    const fixml: string = fe.buffer.toString()\r\n    console.log(fixml)\r\n  })\r\n}\r\n\r\nasync function runTest (): Promise<any> {\r\n  return new Promise<any>(async (accept, reject) => {\r\n    try {\r\n      const res: any = await testGenerator()\r\n      accept(res)\r\n    } catch (e) {\r\n      console.log(e.message)\r\n      reject(e)\r\n    }\r\n  })\r\n}\r\n\r\nfunction streamExample () {\r\n  const fs: any = require('fs')\r\n  const root: string = path.join(__dirname, '../')\r\n  const file: string = path.join(root,'data/examples/FIXML/cme/Claiming Firm Requests Sub-allocation with Allocation Instructions/')\r\n  let readStream: ReadStream = fs.createReadStream(`${file}/fix.xml`)\r\n  const Writable = require('stream').Writable\r\n  const receiver = new Writable({\r\n    write: (data: Buffer, _: any, done: Function) => {\r\n      console.log('receive ' + data)\r\n      done()\r\n    }\r\n  })\r\n  readStream.pipe(receiver).on('finish', () => {\r\n    console.log('done')\r\n  })\r\n}\r\n\r\nasync function compileDefinitions (definitionPath: string, outputPath: string) {\r\n  const definitions = await getDefinitions(definitionPath)\r\n  const compilerSettings: ICompilerSettings = require('../data/compiler.json')\r\n  compilerSettings.output = outputPath\r\n  const msgCompiler: MsgCompiler = new MsgCompiler(definitions, compilerSettings)\r\n  await msgCompiler.generate()\r\n  const enumCompiler: EnumCompiler = new EnumCompiler(definitions, compilerSettings)\r\n  const writeFile = path.join(compilerSettings.output, './enum/all-enum.ts')\r\n  await enumCompiler.generate(writeFile)\r\n\r\n  const writeFileTypes = path.join(compilerSettings.output, './enum/msg-type.ts')\r\n  await enumCompiler.generate(writeFile)\r\n}\r\n\r\nasync function compiler () {\r\n  // 'C:/Users/Stephen/dev/js/jsfix/data/fix_repo/fixmlschema_FIX.5.0SP2_EP228'\r\n  // await compileDefinitions('data/fix_repo/FIX.4.4/Base', 'C:/Users/Stephen/dev/ts/jsfix/src/types/FIX4.4/repo')\r\n  // await compileDefinitions('data/FIX44.xml', 'C:/Users/Stephen/dev/ts/jsfix/src/types/FIX4.4/quickfix')\r\n  await compileDefinitions('data/fix_repo/fixmlschema_FIX.5.0SP2_EP228', 'C:/Users/Stephen/dev/ts/jsfix/src/types/FIXML50SP2')\r\n}\r\n\r\nasync function generateMessage () {\r\n  await testGenerator()\r\n}\r\n\r\nasync function decode (): Promise<any> {\r\n  const definitions: FixDefinitions = await getDefinitions('data/fix_repo/FIX.4.4/Base')\r\n  const txt = '8=FIX4.4|9=0001022|35=AE|49=init-comp|56=accept-comp|34=1|57=fix|52=20180909-14:22:09.841|571=Lorem|487=23513|856=1|568=ipsum|828=6|855=23619|830=dolor|150=F|748=17140|912=N|325=N|263=1|881=sit|818=amet,|820=consectetur|880=adipiscing|17=elit.|39=3|527=Nunc|570=N|423=8|55=odio|65=orci,|48=blandit|22=3|460=4|461=vel|167=MPT|762=semper|200=sed,|541=20180909|201=0|224=20180909|225=20180909|227=-8796.1|228=-23.537|255=bibendum|543=cursus|470=lectus.|471=Aenean|472=vel|240=20180909|202=891.7|947=-2928.1|231=5.7237|223=-1894.1|106=diam|348=9|349=6YYz0zu5s|350=8|351=TuH3tTNd|691=magna.|667=Aenean|875=99|876=et|873=20180909|874=20180909|913=viverra|914=leo,|915=20180909|916=20180909|919=0|898=0.5594|38=96682|152=19226|516=9.1251|854=0|235=PREVCLOSE|236=-2833.5|701=20180909|696=20180909|697=-6.095|698=26303|823=non|32=9253|31=2065.4|194=-73.233|30=iaculis|75=20180909|715=20180909|6=5.9279|218=0.0001953|221=neque.|222=Nullam|663=16216|699=arcu|761=lectus,|824=dignissim|63=3|64=20180909|573=0|574=M3|797=Y|852=Y|853=3|10=16|'\r\n  const startsAt: Date = new Date()\r\n  let i = 0\r\n  const repeats = 1\r\n  const asciiParser: MsgParser = new AsciiParser(definitions, new StringDuplex(txt.repeat(repeats)).readable, AsciiChars.Pipe)\r\n  asciiParser.on('msg', (msgType: string, v: MsgView) => {\r\n    ++i\r\n    console.log(v.toJson())\r\n    if (i === repeats) {\r\n      const elapsed: number = new Date().getTime() - startsAt.getTime()\r\n      console.log(`elapsed ms ${elapsed} ${(elapsed / repeats) * 1000} micros per msg`)\r\n    }\r\n  })\r\n}\r\n\r\nasync function http (): Promise<any> {\r\n  const sessionDescription: ISessionDescription = require('../data/session/test-http-acceptor.json')\r\n  const definitions = await getDefinitions(sessionDescription.application.dictionary)\r\n  const logFactory = new JsFixWinstonLogFactory(WinstonLogger.consoleOptions('info'))\r\n  const config = new JsFixConfig(null, definitions, sessionDescription, AsciiChars.Pipe, logFactory)\r\n  // const acceptor = acceptor(config)\r\n  const xml = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n' +\r\n    '<FIXML v=\"5.0 SP2\" s=\"20090815\" xv=\"109\" cv=\"CME.0001\">\\n' +\r\n    '    <UserReq UserReqID=\"123456\" UserReqTyp=\"1\" Username=\"user123\" Password=\"User!Pass5\">\\n' +\r\n    '        <Hdr SID=\"BRKR\" SSub=\"user123\" TID=\"CME\" TSub=\"CPAPI\"/>\\n' +\r\n    '    </UserReq>\\n' +\r\n    '</FIXML>'\r\n  // acceptor.listen()\r\n  requestPromise({\r\n    method: 'POST',\r\n    uri: 'http://localhost:2343/session',\r\n    body: {\r\n      fixml : xml\r\n    },\r\n    json: true // Automatically stringifies the body to JSON\r\n  }).then(function (parsedBody) {\r\n    console.log(parsedBody)\r\n    // POST succeeded...\r\n  })\r\n    .catch((err: Error) => {\r\n      console.log(err)\r\n      // POST failed...\r\n    })\r\n}\r\n\r\n// http()\r\n// decode()\r\n// generateMessage()\r\n// compiler()\r\n// stronglyTyped()\r\n// streamExample()\r\n// testEncodeDecode()\r\nrepository()\r\n// testEncodeDecode()\r\n// runTest();\r\n// testSocket()\r\n// testRead();\r\n"]}