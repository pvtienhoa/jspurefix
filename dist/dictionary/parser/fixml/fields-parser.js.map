{"version":3,"file":"fields-parser.js","sourceRoot":"","sources":["../../../../src/dictionary/parser/fixml/fields-parser.ts"],"names":[],"mappings":"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","sourcesContent":["import { ILooseObject } from '../../../collections/collection'\r\nimport { ISaxNode } from '../../dict-primitive'\r\nimport { Dictionary } from '../../../collections'\r\nimport { SimpleFieldDefinition, FixDefinitions } from '../../definition'\r\nimport { XsdParser } from './xsd-parser'\r\n\r\ninterface ISimpleField extends ILooseObject {\r\n  restrictionBase: string\r\n  documentation: string\r\n  Protocol: string\r\n  simpleTypeName: string\r\n  name: string\r\n  ComponentType: string,\r\n  Tag: string,\r\n  Type: string\r\n  AbbrName: string\r\n  Category: string\r\n  CategoryAbbrName: string\r\n  enums: Dictionary<string>\r\n  currentEnum: string\r\n}\r\n\r\ninterface IAlias {\r\n  name: string\r\n  mapped: string\r\n}\r\n\r\nexport class FieldsParser extends XsdParser {\r\n  private alias: IAlias[] = []\r\n  public constructor (public readonly definitions: FixDefinitions) {\r\n    super(definitions)\r\n  }\r\n\r\n  public value (line: number, n: string, v: string): void {\r\n    const current: ISimpleField = this.current as ISimpleField\r\n    switch (n) {\r\n      case 'fm:EnumDoc': {\r\n        current.enums.add(current.currentEnum, v)\r\n        break\r\n      }\r\n      case 'xs:documentation': {\r\n        this.current['documentation'] = v\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  public close (line: number, node: string): void {\r\n    const current: ISimpleField = this.current as ISimpleField\r\n    switch (node) {\r\n      case'xs:simpleType': {\r\n        this.data[this.data.length] = current\r\n        break\r\n      }\r\n\r\n      case 'xs:schema': {\r\n        this.insertFields()\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  public open (line: number, node: ISaxNode): void {\r\n    switch (node.name) {\r\n\r\n      case 'xs:simpleType': {\r\n        this.current = {\r\n          simpleTypeName: node.attributes['name']\r\n        } as ISimpleField\r\n        break\r\n      }\r\n\r\n      case 'fm:Xref': {\r\n        this.assign(node)\r\n        break\r\n      }\r\n\r\n      case 'xs:restriction': {\r\n        this.current.restrictionBase = node.attributes['base']\r\n        break\r\n      }\r\n\r\n      case 'fm:EnumDoc': {\r\n        if (!this.current.enums) {\r\n          this.current.enums = new Dictionary<string>()\r\n        }\r\n        this.current.currentEnum = node.attributes['value']\r\n        this.pending = node.name\r\n        break\r\n      }\r\n\r\n      default:\r\n        this.pending = node.name\r\n    }\r\n  }\r\n\r\n  private insertFields (): void {\r\n    const alias = this.alias\r\n    this.data.forEach((f: ISimpleField) => {\r\n      const sf: SimpleFieldDefinition = new SimpleFieldDefinition(f.Tag,\r\n        f.name,\r\n        f.AbbrName,\r\n        f.Category,\r\n        f.CategoryAbbrName,\r\n        f.Type,\r\n        f.documentation)\r\n      if (f.enums) {\r\n        f.enums.forEach((k: string, v: string) => {\r\n          sf.addEnum(k, v)\r\n        })\r\n      }\r\n      if (f.name && f.Type && f.Tag) {\r\n        this.definitions.addSimpleFieldDef(sf, f.simpleTypeName)\r\n      } else if (f.restrictionBase && f.simpleTypeName) {\r\n        let mapped = f.simpleTypeName\r\n        if (mapped.endsWith('_t')) {\r\n          mapped = mapped.replace(/_t$/, '')\r\n        } else {\r\n          mapped = f.restrictionBase\r\n        }\r\n        alias.push({\r\n          name: f.simpleTypeName,\r\n          mapped: mapped\r\n        })\r\n      }\r\n    })\r\n    alias.forEach((a: IAlias) => {\r\n      this.definitions.addSimpleAlias(a.mapped, a.name)\r\n    })\r\n  }\r\n}\r\n"]}