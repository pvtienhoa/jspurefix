{"version":3,"file":"msg-compiler.js","sourceRoot":"","sources":["../../../src/dictionary/compiler/msg-compiler.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,yCAA8D;AAI9D,yDAAoD;AACpD,sDAAoD;AACpD,mDAA8C;AAC9C,mDAA8C;AAE9C,yBAAwB;AACxB,6BAA4B;AAC5B,6BAA4B;AAC5B,wDAAmD;AACnD,8CAAyC;AAEzC,MAAa,WAAW;IAMtB,YAA6B,WAA2B,EAAkB,QAA2B;QAAxE,gBAAW,GAAX,WAAW,CAAgB;QAAkB,aAAQ,GAAR,QAAQ,CAAmB;QAL5F,UAAK,GAAmB,EAAE,CAAA;QAE1B,WAAM,GAAkB,IAAI,sBAAa,EAAE,CAAA;QAIlD,IAAI,CAAC,SAAS,GAAG,IAAI,wBAAU,EAAgB,CAAA;QAC/C,IAAI,CAAC,QAAQ,GAAG,IAAI,kCAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;IACpD,CAAC;IAEY,QAAQ;;YACnB,MAAM,KAAK,GAAa,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE,CAAA;YAC9E,OAAO,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAA;QAChC,CAAC;KAAA;IAEO,WAAW,CAAE,YAA0B;QAC7C,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;QAC9B,MAAM,QAAQ,GAAG,GAAG,YAAY,CAAC,MAAM,KAAK,CAAA;QAC5C,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAA;IAC7C,CAAC;IAEa,WAAW,CAAE,KAAe;;YACxC,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAA;YACpC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAY,EAAE,EAAE;gBAC7B,MAAM,UAAU,GAAG,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;gBACjD,IAAI,CAAC,UAAU,EAAE;oBACf,MAAM,IAAI,KAAK,CAAC,WAAW,IAAI,UAAU,CAAC,CAAA;iBAC3C;gBACD,MAAM,EAAE,GAAG,IAAI,4BAAY,CAAC,IAAI,CAAC,WAAW,EAAE,UAAU,EAAE,UAAU,CAAC,IAAI,CAAC,CAAA;gBAC1E,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;YAClB,CAAC,CAAC,CAAA;YACF,MAAM,IAAI,CAAC,IAAI,EAAE,CAAA;YACjB,MAAM,IAAI,CAAC,KAAK,EAAE,CAAA;QACpB,CAAC;KAAA;IAEa,IAAI;;YAChB,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAA;YACpB,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,CAAA;YAC9C,OAAO,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;gBACnB,MAAM,YAAY,GAAiB,CAAC,CAAC,GAAG,EAAE,CAAA;gBAC1C,MAAM,GAAG,GAAW,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAA;gBACvD,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,CAAA;gBAC/C,MAAM,SAAS,CAAC,QAAQ,EAAE,GAAG,EAAE;oBAC7B,QAAQ,EAAE,MAAM;iBAAC,CAClB,CAAA;aACF;QACH,CAAC;KAAA;IAEa,KAAK;;YACjB,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,CAAA;YAC9C,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;YAC9B,MAAM,QAAQ,GAAG,UAAU,CAAA;YAC3B,MAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAA;YACpC,MAAM,OAAO,GAAa,IAAI,CAAC,MAAM,CAAC,CAAC,IAAc,EAAE,OAAqB,EAAE,EAAE;gBAC9E,IAAI,CAAC,IAAI,CAAC,kBAAkB,OAAO,CAAC,MAAM,GAAG,CAAC,CAAA;gBAC9C,OAAO,IAAI,CAAA;YACb,CAAC,EAAE,CAAC,wBAAwB,CAAa,CAAC,CAAA;YAC1C,MAAM,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,GAAG,CAAA;YACjC,OAAO,CAAC,IAAI,EAAE,CAAA;YACd,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;YAChB,MAAM,GAAG,GAAW,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;YACzC,MAAM,QAAQ,GAAW,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAA;YAC7D,MAAM,SAAS,CAAC,QAAQ,EAAE,GAAG,EAAE;gBAC7B,QAAQ,EAAE,MAAM;aAAC,CAClB,CAAA;QACH,CAAC;KAAA;IAEO,gBAAgB,CAAE,YAA0B;QAClD,MAAM,UAAU,GAAG,YAAY,CAAC,GAAG,CAAA;QACnC,MAAM,MAAM,GAAkB,IAAI,CAAC,MAAM,CAAA;QACzC,MAAM,CAAC,KAAK,EAAE,CAAA;QACd,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;QAC9B,MAAM,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,GAAG,CAAA;QAEjC,IAAI,GAAG,GAAW,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAA;QAC5C,IAAI,GAAG,GAAG,CAAC,EAAE;YACX,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;YAC3B,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;SAC5B;QACD,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,IAAI,UAAU,CAAC,WAAW,EAAE;YACnD,MAAM,OAAO,GAAG,QAAQ,CAAC,UAAU,CAAC,UAAU,CAAC,WAAW,CAAC,CAAA;YAC3D,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAA;YACjD,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;YAC3B,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;YAC3B,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;YAC3B,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAA;YAC/C,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;SAC5B;QACD,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC,CAAA;QACrE,MAAM,CAAC,SAAS,CAAC,mBAAU,CAAC,KAAK,CAAC,CAAA;QAClC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAA;QAC1C,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;QAC3B,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,CAAA;QACzB,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAA;QACxC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;QAC3B,OAAO,MAAM,CAAC,QAAQ,EAAE,CAAA;IAC1B,CAAC;IAGO,OAAO,CAAE,EAAgB;QAC/B,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAA;QAChC,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAA;QACrC,IAAI,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;YAC3B,OAAM;SACP;QACD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;QACnB,SAAS,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAA;IACnC,CAAC;IAEO,WAAW,CAAE,MAA4B;QAC/C,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;QAC9B,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;QAC9B,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;QAC1B,MAAM,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,GAAG,CAAA;QACjC,MAAM,GAAG,GAAG,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,aAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAA;QACvG,IAAI,QAAQ,CAAC,IAAI,EAAE;YACjB,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,WAAW,CAAC,GAAG,MAAM,CAAC,UAAU,CAAC,GAAG,EAAE,EAAE,EAAE,GAAG,GAAG,CAAC,CAAC,CAAA;SAC/E;QACD,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;IAC7B,CAAC;IAEO,UAAU,CAAE,UAA+B,EAAE,YAA0B;QAC7E,MAAM,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,GAAG,CAAA;QACjC,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;QAC1B,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;QAE9B,MAAM,QAAQ,GAAW,YAAY,CAAC,WAAW,CAAC,UAAU,CAAC,CAAA;QAC7D,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,YAAY,CAAC,iBAAiB,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE,UAAU,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAA;QAChH,IAAI,CAAC,OAAO,CAAC,IAAI,4BAAY,CAAC,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAA;QACjF,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;IAC7B,CAAC;IAEO,cAAc,CAAE,cAAuC,EAAE,YAA0B;QACzF,MAAM,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,GAAG,CAAA;QACjC,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;QAC1B,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;QAC9B,MAAM,QAAQ,GAAW,YAAY,CAAC,WAAW,CAAC,cAAc,CAAC,CAAA;QACjE,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,EAAE,cAAc,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAA;QAC5E,IAAI,CAAC,OAAO,CAAC,IAAI,4BAAY,CAAC,IAAI,CAAC,WAAW,EAAE,cAAc,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAA;QACrF,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;IAC7B,CAAC;IAEO,MAAM,CAAE,YAA0B;QACxC,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,CAAA;QAC7B,gCAAc,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,EAAE;YACtC,KAAK,EAAE,CAAC,CAAsB,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE,YAAY,CAAC;YACnE,MAAM,EAAE,CAAC,MAA4B,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YAClE,SAAS,EAAE,CAAC,CAA0B,EAAE,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,EAAE,YAAY,CAAC;SAChF,CAAC,CAAA;IACJ,CAAC;IAEO,UAAU,CAAE,YAA0B;QAC5C,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;QAC9B,MAAM,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,GAAG,CAAA;QACjC,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;QAC9B,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;QAC1B,YAAY,CAAC,GAAG,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,MAA4B,EAAE,EAAE;YACvE,MAAM,GAAG,GAAG,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,EAAE,aAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAA;YAClH,IAAI,QAAQ,CAAC,IAAI,EAAE;gBACjB,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,WAAW,CAAC,GAAG,MAAM,CAAC,UAAU,CAAC,GAAG,EAAE,EAAE,EAAE,GAAG,GAAG,CAAC,CAAC,CAAA;aAC/E;YACD,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;QAC7B,CAAC,CAAC,CAAA;IACJ,CAAC;IAEO,OAAO,CAAE,YAA0B;QACzC,MAAM,KAAK,GAAG,YAAY,CAAC,GAAG,CAAC,IAAI,KAAK,iCAAgB,CAAC,GAAG,CAAA;QAC5D,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAA;QAC9B,MAAM,OAAO,GAAa,sBAAS,CAAW,YAAY,CAAC,GAAG,EAAE;YAC9D,SAAS,EAAE,CAAC,CAAW,EAAE,CAA0B,EAAE,EAAE;gBACrD,CAAC,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAA;gBACnE,OAAO,CAAC,CAAA;YACV,CAAC;YACD,KAAK,EAAE,CAAC,CAAW,EAAE,CAAsB,EAAE,EAAE;gBAC7C,CAAC,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAA;gBACnE,OAAO,CAAC,CAAA;YACV,CAAC;SACF,EAAE,EAAE,CAAC,CAAA;QAEN,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAA;IACjE,CAAC;CACF;AAtLD,kCAsLC","sourcesContent":["import { ElasticBuffer, AsciiChars, Tags } from '../../buffer'\r\nimport { ICompilerSettings } from './compiler-settings'\r\nimport { FixDefinitions } from '../definition'\r\nimport { ContainedGroupField, ContainedSimpleField, ContainedComponentField } from '../contained'\r\nimport { StandardSnippet } from './standard-snippet'\r\nimport { ContainedSetType } from '../dict-primitive'\r\nimport { CompilerType } from './compiler-type'\r\nimport { Dictionary } from '../../collections'\r\n\r\nimport * as fs from 'fs'\r\nimport * as Util from 'util'\r\nimport * as Path from 'path'\r\nimport { dispatchFields } from '../fields-dispatch'\r\nimport { reduceSet } from '../set-reduce'\r\n\r\nexport class MsgCompiler {\r\n  readonly queue: CompilerType[] = []\r\n  readonly snippets: StandardSnippet\r\n  readonly buffer: ElasticBuffer = new ElasticBuffer()\r\n  readonly completed: Dictionary<CompilerType>\r\n\r\n  constructor (public readonly definitions: FixDefinitions, public readonly settings: ICompilerSettings) {\r\n    this.completed = new Dictionary<CompilerType>()\r\n    this.snippets = new StandardSnippet(this.settings)\r\n  }\r\n\r\n  public async generate () {\r\n    const types: string[] = this.settings.types || this.definitions.message.keys()\r\n    return this.createTypes(types)\r\n  }\r\n\r\n  private getFileName (compilerType: CompilerType): string {\r\n    const settings = this.settings\r\n    const fileName = `${compilerType.snaked}.ts`\r\n    return Path.join(settings.output, fileName)\r\n  }\r\n\r\n  private async createTypes (types: string[]) {\r\n    const definitions = this.definitions\r\n    types.forEach((type: string) => {\r\n      const definition = definitions.containedSet(type)\r\n      if (!definition) {\r\n        throw new Error(`no type ${type} defined`)\r\n      }\r\n      const ct = new CompilerType(this.definitions, definition, definition.name)\r\n      this.enqueue(ct)\r\n    })\r\n    await this.work()\r\n    await this.index()\r\n  }\r\n\r\n  private async work () {\r\n    const q = this.queue\r\n    const writeFile = Util.promisify(fs.writeFile)\r\n    while (q.length > 0) {\r\n      const compilerType: CompilerType = q.pop()\r\n      const api: string = this.generateMessages(compilerType)\r\n      const fullName = this.getFileName(compilerType)\r\n      await writeFile(fullName, api, {\r\n        encoding: 'utf8'}\r\n      )\r\n    }\r\n  }\r\n\r\n  private async index () {\r\n    const writeFile = Util.promisify(fs.writeFile)\r\n    const settings = this.settings\r\n    const fileName = 'index.ts'\r\n    const done = this.completed.values()\r\n    const exports: string[] = done.reduce((prev: string[], current: CompilerType) => {\r\n      prev.push(`export * from '${current.snaked}'`)\r\n      return prev\r\n    }, [`export * from './enum'`] as string[])\r\n    const newLine = require('os').EOL\r\n    exports.sort()\r\n    exports.push('')\r\n    const api: string = exports.join(newLine)\r\n    const fullName: string = Path.join(settings.output, fileName)\r\n    await writeFile(fullName, api, {\r\n      encoding: 'utf8'}\r\n    )\r\n  }\r\n\r\n  private generateMessages (compilerType: CompilerType): string {\r\n    const definition = compilerType.set\r\n    const buffer: ElasticBuffer = this.buffer\r\n    buffer.reset()\r\n    const snippets = this.snippets\r\n    const newLine = require('os').EOL\r\n    // a single class with dependencies included\r\n    let ptr: number = this.imports(compilerType)\r\n    if (ptr > 0) {\r\n      buffer.writeString(newLine)\r\n      buffer.writeString(newLine)\r\n    }\r\n    if (this.settings.comment && definition.description) {\r\n      const comment = snippets.commentBox(definition.description)\r\n      buffer.writeString(snippets.startBlockComment(0))\r\n      buffer.writeString(newLine)\r\n      buffer.writeString(comment)\r\n      buffer.writeString(newLine)\r\n      buffer.writeString(snippets.endBlockComment(0))\r\n      buffer.writeString(newLine)\r\n    }\r\n    buffer.writeString(snippets.interface(compilerType.qualifiedName, 0))\r\n    buffer.writeChar(AsciiChars.Space)\r\n    buffer.writeString(snippets.startBlock(0))\r\n    buffer.writeString(newLine)\r\n    this.fields(compilerType)\r\n    buffer.writeString(snippets.endBlock(0))\r\n    buffer.writeString(newLine)\r\n    return buffer.toString()\r\n  }\r\n\r\n  // only generate once\r\n  private enqueue (ct: CompilerType): void {\r\n    const completed = this.completed\r\n    const fullName = this.getFileName(ct)\r\n    if (completed.get(fullName)) {\r\n      return\r\n    }\r\n    this.queue.push(ct)\r\n    completed.addUpdate(fullName, ct)\r\n  }\r\n\r\n  private fieldSimple (simple: ContainedSimpleField): void {\r\n    const snippets = this.snippets\r\n    const settings = this.settings\r\n    const buffer = this.buffer\r\n    const newLine = require('os').EOL\r\n    const len = buffer.writeString(snippets.simple(simple.name, Tags.toJSType(simple), simple.required, 1))\r\n    if (settings.tags) {\r\n      buffer.writeString(snippets.commentLine(`${simple.definition.tag}`, 50 - len))\r\n    }\r\n    buffer.writeString(newLine)\r\n  }\r\n\r\n  private fieldGroup (groupField: ContainedGroupField, compilerType: CompilerType): void {\r\n    const newLine = require('os').EOL\r\n    const buffer = this.buffer\r\n    const snippets = this.snippets\r\n    // for a group its field name is as defined in type, its type is qualified to avoid collisions\r\n    const extended: string = compilerType.getExtended(groupField)\r\n    buffer.writeString(snippets.group(compilerType.getFieldGroupName(groupField), extended, groupField.required, 1))\r\n    this.enqueue(new CompilerType(this.definitions, groupField.definition, extended))\r\n    buffer.writeString(newLine)\r\n  }\r\n\r\n  private fieldComponent (componentField: ContainedComponentField, compilerType: CompilerType): void {\r\n    const newLine = require('os').EOL\r\n    const buffer = this.buffer\r\n    const snippets = this.snippets\r\n    const extended: string = compilerType.getExtended(componentField)\r\n    buffer.writeString(snippets.component(extended, componentField.required, 1))\r\n    this.enqueue(new CompilerType(this.definitions, componentField.definition, extended))\r\n    buffer.writeString(newLine)\r\n  }\r\n\r\n  private fields (compilerType: CompilerType): void {\r\n    this.attributes(compilerType)\r\n    dispatchFields(compilerType.set.fields, {\r\n      group: (g: ContainedGroupField) => this.fieldGroup(g, compilerType),\r\n      simple: (simple: ContainedSimpleField) => this.fieldSimple(simple),\r\n      component: (c: ContainedComponentField) => this.fieldComponent(c, compilerType)\r\n    })\r\n  }\r\n\r\n  private attributes (compilerType: CompilerType): void {\r\n    const settings = this.settings\r\n    const newLine = require('os').EOL\r\n    const snippets = this.snippets\r\n    const buffer = this.buffer\r\n    compilerType.set.localAttribute.forEach((simple: ContainedSimpleField) => {\r\n      const len = buffer.writeString(snippets.simple(simple.definition.name, Tags.toJSType(simple), simple.required, 1))\r\n      if (settings.tags) {\r\n        buffer.writeString(snippets.commentLine(`${simple.definition.tag}`, 50 - len))\r\n      }\r\n      buffer.writeString(newLine)\r\n    })\r\n  }\r\n\r\n  private imports (compilerType: CompilerType): number {\r\n    const isMsg = compilerType.set.type === ContainedSetType.Msg\r\n    const snippets = this.snippets\r\n    const imports: string[] = reduceSet<string[]>(compilerType.set, {\r\n      component: (a: string[], c: ContainedComponentField) => {\r\n        a.push(`${snippets.import(compilerType.getExtended(c), isMsg, 0)}`)\r\n        return a\r\n      },\r\n      group: (a: string[], g: ContainedGroupField) => {\r\n        a.push(`${snippets.import(compilerType.getExtended(g), isMsg, 0)}`)\r\n        return a\r\n      }\r\n    }, [])\r\n\r\n    return this.buffer.writeString(imports.join(require('os').EOL))\r\n  }\r\n}\r\n"]}