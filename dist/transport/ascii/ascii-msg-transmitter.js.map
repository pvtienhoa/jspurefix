{"version":3,"file":"ascii-msg-transmitter.js","sourceRoot":"","sources":["../../../src/transport/ascii/ascii-msg-transmitter.ts"],"names":[],"mappings":";;AAAA,+CAAiE;AACjE,wDAAmD;AAKnD,MAAa,mBAAoB,SAAQ,gCAAc;IAOrD,YAA6B,MAAoB;QAE/C,KAAK,CAAC,MAAM,CAAC,WAAW,EAAE,MAAM,CAAC,WAAW,CAAC,CAAA;QAFlB,WAAM,GAAN,MAAM,CAAc;QAN1C,cAAS,GAAW,CAAC,CAAA;QAS1B,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;QAC1B,MAAM,EAAE,GAAkB,IAAI,qBAAa,CAAC,MAAM,CAAC,CAAA;QACnD,IAAI,CAAC,OAAO,GAAG,IAAI,oBAAY,CAAC,MAAM,EAAE,MAAM,CAAC,WAAW,EAAE,EAAE,EAAE,MAAM,CAAC,SAAS,CAAC,CAAA;QACjF,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;QACxD,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,CAAA;IAC5D,CAAC;IAEM,aAAa,CAAE,OAAe,EAAE,GAAiB;QACtD,MAAM,OAAO,GAAiB,IAAI,CAAC,OAAuB,CAAA;QAC1D,MAAM,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAA;QACnC,MAAM,GAAG,GAAiB,OAAO,CAAC,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS,EAAE,EAAC,IAAI,CAAC,IAAI,IAAI,IAAI,IAAI,EAAE,CAAC,CAAA;QAC3F,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;QAC1B,MAAM,CAAC,KAAK,EAAE,CAAA;QACd,MAAM,MAAM,GAAsB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;QACvE,IAAI,CAAC,MAAM,EAAE;YACX,OAAM;SACP;QACD,OAAO,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;QACrC,OAAO,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,IAAI,CAAC,CAAA;QAChC,MAAM,MAAM,GAAG,OAAO,CAAC,aAAa,CAAA;QACpC,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;QAC1C,MAAM,CAAC,sBAAsB,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC,CAAA;QAC7C,MAAM,QAAQ,GAAW,MAAM,CAAC,QAAQ,EAAE,CAAA;QAC1C,MAAM,GAAG,GAAiB,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAA;QACnD,OAAO,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;IACxC,CAAC;CACF;AApCD,kDAoCC","sourcesContent":["import { TimeFormatter, AsciiEncoder } from '../../buffer/ascii/'\r\nimport { MsgTransmitter } from '../msg-transmitter'\r\nimport { ILooseObject } from '../../collections/collection'\r\nimport { MessageDefinition, ContainedFieldSet } from '../../dictionary'\r\nimport { IJsFixConfig } from '../../config'\r\n\r\nexport class AsciiMsgTransmitter extends MsgTransmitter {\r\n  public msgSeqNum: number = 1\r\n  public time: Date\r\n\r\n  private readonly header: ContainedFieldSet\r\n  private readonly trailer: ContainedFieldSet\r\n\r\n  constructor (public readonly config: IJsFixConfig) {\r\n\r\n    super(config.definitions, config.description)\r\n    const buffer = this.buffer\r\n    const tf: TimeFormatter = new TimeFormatter(buffer)\r\n    this.encoder = new AsciiEncoder(buffer, config.definitions, tf, config.delimiter)\r\n    this.header = config.definitions.component.get('header')\r\n    this.trailer = config.definitions.component.get('trailer')\r\n  }\r\n\r\n  public encodeMessage (msgType: string, obj: ILooseObject): void {\r\n    const encoder: AsciiEncoder = this.encoder as AsciiEncoder\r\n    const factory = this.config.factory\r\n    const hdr: ILooseObject = factory.header(msgType, this.msgSeqNum++,this.time || new Date())\r\n    const buffer = this.buffer\r\n    buffer.reset()\r\n    const msgDef: MessageDefinition = this.definitions.message.get(msgType)\r\n    if (!msgDef) {\r\n      return\r\n    }\r\n    encoder.encode(hdr, this.header.name)\r\n    encoder.encode(obj, msgDef.name)\r\n    const lenPos = encoder.bodyLengthPos\r\n    const len = buffer.getPos() - (lenPos + 8)\r\n    buffer.patchPaddedNumberAtPos(lenPos, len, 7)\r\n    const checksum: number = buffer.checksum()\r\n    const trl: ILooseObject = factory.trailer(checksum)\r\n    encoder.encode(trl, this.trailer.name)\r\n  }\r\n}\r\n"]}