{"version":3,"file":"repo-full-ascii-msg.test.js","sourceRoot":"","sources":["../../src/test/repo-full-ascii-msg.test.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from 'path'\r\nimport { AsciiParser, AsciiView, AsciiChars } from '../buffer'\r\nimport { ILooseObject } from '../collections/collection'\r\nimport { FixDefinitions } from '../dictionary'\r\nimport { JsonHelper, getDefinitions } from '../util'\r\nimport { ISessionDescription, SessionMsgFactory, AsciiMsgTransmitter } from '../transport'\r\nimport { JsFixConfig } from '../config'\r\n\r\nlet definitions: FixDefinitions\r\nlet jsonHelper: JsonHelper\r\nlet session: AsciiMsgTransmitter\r\nconst root: string = path.join(__dirname, '../../data')\r\n\r\nbeforeAll(async () => {\r\n  const sessionDescription: ISessionDescription = require(path.join(root, 'session/test-initiator.json'))\r\n  definitions = await getDefinitions(sessionDescription.application.dictionary)\r\n  jsonHelper = new JsonHelper(definitions)\r\n  const config = new JsFixConfig(new SessionMsgFactory(sessionDescription), definitions, sessionDescription, AsciiChars.Pipe)\r\n  session = new AsciiMsgTransmitter(config)\r\n}, 45000)\r\n\r\nasync function testEncodeDecode (msgType: string, msg: ILooseObject): Promise<ILooseObject> {\r\n  // encode to FIX format from provided object.\r\n  return new Promise(async (resolve, reject) => {\r\n    const parser: AsciiParser = new AsciiParser(definitions, session.encodeStream, AsciiChars.Pipe)\r\n    parser.on('msg', (msgType: string, view: AsciiView) => {\r\n      const o = view.toObject()\r\n      delete o['StandardHeader']\r\n      delete o['StandardTrailer']\r\n      resolve(o)\r\n    })\r\n    parser.on('error', (e: Error) => {\r\n      reject(e)\r\n    })\r\n    // encode the message\r\n    session.send(msgType, msg)\r\n  })\r\n}\r\n\r\ntest('AE object to ascii fix to object', async () => {\r\n  const msgType: string = 'AE'\r\n  const file: string = path.join(root, 'examples/FIX.4.4/repo/trade-capture/object.json')\r\n  const msg: ILooseObject = jsonHelper.fromJson(file, msgType)\r\n  const o: ILooseObject = await testEncodeDecode(msgType, msg)\r\n\r\n  await expect(o).toEqual(msg)\r\n}, 1000)\r\n\r\ntest('d object to ascii fix to object', async () => {\r\n  const msgType: string = 'd'\r\n  const file: string = path.join(root, 'examples/FIX.4.4/repo/security-definition/object.json')\r\n  const msg: ILooseObject = jsonHelper.fromJson(file, msgType)\r\n  const o: ILooseObject = await testEncodeDecode(msgType, msg)\r\n\r\n  await expect(o).toEqual(msg)\r\n}, 1000)\r\n\r\ntest('D object to ascii fix to object', async () => {\r\n  const msgType: string = 'D'\r\n  const file: string = path.join(root, 'examples/FIX.4.4/repo/new-order-single/object.json')\r\n  const msg: ILooseObject = jsonHelper.fromJson(file, msgType)\r\n  const o: ILooseObject = await testEncodeDecode(msgType, msg)\r\n\r\n  await expect(o).toEqual(msg)\r\n}, 1000)\r\n"]}