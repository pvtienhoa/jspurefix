{"version":3,"file":"ascii-tag-pos.test.js","sourceRoot":"","sources":["../../src/test/ascii-tag-pos.test.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from 'path'\r\nimport { AsciiChars, MsgView, TagPos, Structure } from '../buffer'\r\nimport { FixDefinitions } from '../dictionary'\r\nimport { ISessionDescription, AsciiMsgTransmitter } from '../transport'\r\nimport { JsFixConfig } from '../config'\r\nimport { getDefinitions, replayFixFile } from '../util'\r\n\r\nconst root: string = path.join(__dirname, '../../data')\r\n\r\nlet definitions: FixDefinitions\r\nlet session: AsciiMsgTransmitter\r\nlet views: MsgView[]\r\nlet structure: Structure\r\nlet tp: TagPos[]\r\n\r\nconst testTags: TagPos[] = [\r\n  new TagPos(0, 120, 0, 1), // 3\r\n  new TagPos(1, 50, 1, 1), // 0\r\n  new TagPos(2, 50, 2, 1), // 1\r\n  new TagPos(3, 120, 3, 1), // 4\r\n  new TagPos(4, 100, 4, 1) // 2\r\n]\r\n\r\nconst expected: TagPos[] = [\r\n  new TagPos(1, 50, 1, 1), // 0\r\n  new TagPos(2, 50, 2, 1), // 1\r\n  new TagPos(4, 100, 4, 1), // 2\r\n  new TagPos(0, 120, 0, 1), // 3\r\n  new TagPos(3, 120, 3, 1) // 4\r\n]\r\n\r\nconst unsortedLogon = [\r\n  new TagPos(0, 8, 2, 6),\r\n  new TagPos(1, 9, 11, 7),\r\n  new TagPos(2, 35, 22, 1),\r\n  new TagPos(3, 49, 27, 9),\r\n  new TagPos(4, 56, 40, 9),\r\n  new TagPos(5, 34, 53, 1),\r\n  new TagPos(6, 57, 58, 5),\r\n  new TagPos(7, 52, 67, 21),\r\n  new TagPos(8, 98, 92, 1),\r\n  new TagPos(9, 108, 98, 5),\r\n  new TagPos(10, 95, 107, 2),\r\n  new TagPos(11, 96, 113, 20),\r\n  new TagPos(12, 141, 138, 1),\r\n  new TagPos(13, 789, 144, 4),\r\n  new TagPos(14, 383, 153, 2),\r\n  new TagPos(15, 384, 160, 1),\r\n  new TagPos(16, 372, 166, 5),\r\n  new TagPos(17, 385, 176, 1),\r\n  new TagPos(18, 464, 182, 1),\r\n  new TagPos(19, 553, 188, 3),\r\n  new TagPos(20, 554, 196, 11)\r\n]\r\n\r\nbeforeAll(async () => {\r\n  const sessionDescription: ISessionDescription = require(path.join(root, 'session/test-initiator.json'))\r\n  definitions = await getDefinitions(sessionDescription.application.dictionary)\r\n  const config = new JsFixConfig(null, definitions, sessionDescription, AsciiChars.Pipe)\r\n  session = new AsciiMsgTransmitter(config)\r\n  views = await replayFixFile(definitions, sessionDescription, path.join(root, 'examples/FIX.4.4/quickfix/logon/fix.txt'), AsciiChars.Pipe)\r\n  if (views && views.length > 0) {\r\n    structure = views[0].structure\r\n    tp = views[0].structure.tags.tagPos.slice(0, views[0].segment.endPosition)\r\n  }\r\n}, 45000)\r\n\r\ntest('logon tags parsed fully', () => {\r\n  expect(tp).toEqual(unsortedLogon)\r\n})\r\n\r\ntest('expect tags to sort in tag first order', () => {\r\n  const sorted = testTags.slice().sort(TagPos.compare)\r\n  const sortedTags = sorted.map(e => e.tag)\r\n  expect(sortedTags).toEqual([50, 50, 100, 120, 120])\r\n})\r\n\r\ntest('expect tags to sort in tag then start order', () => {\r\n  const sorted = testTags.slice().sort(TagPos.compare)\r\n  expect(sorted[0].tag).toEqual(sorted[1].tag)\r\n  expect(sorted[0].start < sorted[1].start).toEqual(true)\r\n})\r\n\r\ntest('expect start to carry with its tag', () => {\r\n  const sorted = testTags.slice().sort(TagPos.compare)\r\n  expect(sorted).toEqual(expected)\r\n})\r\n\r\ntest('binary search on sorted', () => {\r\n  const sorted = testTags.slice().sort(TagPos.compare)\r\n  expect(TagPos.binarySearch(sorted, 100)).toEqual(2)\r\n})\r\n\r\ntest('binary search for non existing tag', () => {\r\n  const sorted = testTags.slice().sort(TagPos.compare)\r\n  expect(TagPos.binarySearch(sorted, 1000) < 0).toEqual(true)\r\n})\r\n\r\ntest('binary search duplicate tag', () => {\r\n  const sorted = testTags.slice().sort(TagPos.compare)\r\n  expect(TagPos.binarySearch(sorted, 50) <= 1).toEqual(true)\r\n})\r\n\r\ntest('check logon', () => {\r\n  const sorted = tp.slice().sort(TagPos.compare)\r\n  expect(sorted[0].tag).toEqual(8)\r\n  expect(sorted[sorted.length - 1].tag).toEqual(789)\r\n})\r\n"]}