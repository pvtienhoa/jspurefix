{"version":3,"file":"jsfix-cmd.js","sourceRoot":"","sources":["../src/jsfix-cmd.ts"],"names":[],"mappings":"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","sourcesContent":["import { ElasticBuffer, MsgView, MsgParser, AsciiParser, AsciiView, AsciiChars } from './buffer'\r\nimport { ILooseObject } from './collections/collection'\r\nimport { SimpleFieldDefinition, FixDefinitions, MsgCompiler, EnumCompiler, ICompilerSettings } from './dictionary'\r\nimport { MessageGenerator, JsonHelper, getDefinitions, getDictPath, getWords } from './util'\r\nimport { AsciiMsgTransmitter, ISessionDescription, SessionMsgFactory, MsgTransport, FileDuplex, StringDuplex } from './transport'\r\n\r\nimport { MsgTag } from './types/enum'\r\nimport { JsFixConfig } from './config'\r\n\r\nimport * as util from 'util'\r\nconst fs = require('node-fs-extra')\r\nimport * as minimist from 'minimist'\r\nimport * as path from 'path'\r\n\r\nconst argv: any = minimist(process.argv.slice(2))\r\n\r\nenum PrintMode {\r\n  Structure = 1,\r\n  Object = 2,\r\n  Verbose = 3,\r\n  Stats = 4,\r\n  Token = 5,\r\n  Encoded = 6\r\n}\r\n\r\nenum Command {\r\n  Generate = 1,\r\n  Replay = 2,\r\n  Lookup = 3,\r\n  Encode = 4,\r\n  Benchmark = 5,\r\n  Compile = 6,\r\n  Unknown = 7\r\n}\r\n\r\nexport class JsfixCmd {\r\n  private readonly root: string = path.join(__dirname, '../')\r\n  private definitions: FixDefinitions\r\n  private jsonHelper: JsonHelper\r\n  private session: AsciiMsgTransmitter\r\n  private sessionDescription: ISessionDescription\r\n  private delimiter: number = AsciiChars.Soh\r\n  private stats: ILooseObject = {}\r\n  private filter: string = null\r\n  private messages: number = 0\r\n  private print: boolean = true\r\n\r\n  private static getCommand (): Command {\r\n    let command: Command = Command.Unknown\r\n    if (argv.compile) {\r\n      command = Command.Compile\r\n    } else if (argv.generate) {\r\n      command = Command.Generate\r\n    } else if (argv.fix) {\r\n      command = argv.benchmark ? Command.Benchmark : Command.Replay\r\n    } else if (argv.field) {\r\n      command = Command.Lookup\r\n    } else if (argv.json) {\r\n      command = Command.Encode\r\n    }\r\n    return command\r\n  }\r\n\r\n  private static getPrintMode (): PrintMode {\r\n    let mode: PrintMode = PrintMode.Stats\r\n    if (argv.tokens) {\r\n      mode = PrintMode.Token\r\n    } else if (argv.stats) {\r\n      mode = PrintMode.Stats\r\n    } else if (argv.objects) {\r\n      mode = PrintMode.Object\r\n    } else if (argv.verbose) {\r\n      mode = PrintMode.Verbose\r\n    } else if (argv.structures) {\r\n      mode = PrintMode.Structure\r\n    } else if (argv.encoded) {\r\n      mode = PrintMode.Encoded\r\n    }\r\n    return mode\r\n  }\r\n\r\n  private static async writeFile (name: string, api: string) {\r\n    const writer = util.promisify(fs.writeFile)\r\n    await writer(name, api, {\r\n      encoding: 'utf8'}\r\n    ).catch((e: Error) => {\r\n      throw e\r\n    })\r\n  }\r\n\r\n  public exec (): Promise<any> {\r\n    return new Promise<any>((resolve, reject) => {\r\n      this.init().then(async () => {\r\n        let actioned: boolean = true\r\n        let command = JsfixCmd.getCommand()\r\n\r\n        switch (command) {\r\n          case Command.Generate: {\r\n            // produce a test message or a valid fix log of n messages\r\n            await this.generate()\r\n            break\r\n          }\r\n\r\n          case Command.Encode: {\r\n            // encode a json message back to fix\r\n            this.encode()\r\n            break\r\n          }\r\n\r\n          case Command.Replay: {\r\n            // parse a file into either objects, tokens, structures or stats\r\n            const repeats: number = !isNaN(argv.repeats) ? argv.repeats : 1\r\n            try {\r\n              for (let i: number = 0; i < repeats; ++i) {\r\n                await this.replay()\r\n              }\r\n            } catch (e) {\r\n              reject(e)\r\n            }\r\n            break\r\n          }\r\n\r\n          case Command.Benchmark: {\r\n            // time how long to parse 10000 repeats of contents of file\r\n            const repeats: number = !isNaN(argv.repeats) ? argv.repeats : 10000\r\n            try {\r\n              await this.benchmark(repeats)\r\n            } catch (e) {\r\n              reject(e)\r\n            }\r\n            break\r\n          }\r\n\r\n          case Command.Lookup: {\r\n            // lookup a field\r\n            this.field()\r\n            break\r\n          }\r\n\r\n          case Command.Compile: {\r\n            await this.compile()\r\n            break\r\n          }\r\n\r\n          case Command.Unknown:\r\n          default: {\r\n            actioned = false\r\n          }\r\n        }\r\n        resolve(actioned)\r\n      }).catch((e) => {\r\n        reject(e)\r\n      })\r\n    })\r\n  }\r\n\r\n  private firstMessage (t: MsgTransport): Promise<MsgView> {\r\n    return new Promise<MsgView>((resolve, reject) => {\r\n      t.receiver.on('msg', (msgType: string, msgView: MsgView) => {\r\n        resolve(msgView.clone())\r\n      })\r\n      t.receiver.on('error', (e) => {\r\n        reject(e)\r\n      })\r\n    })\r\n  }\r\n\r\n  private async generate () {\r\n    const lipPath: string = path.join(this.root, 'data/examples/lipsum.txt')\r\n    const words: string[] = await getWords(lipPath)\r\n    const generator = new MessageGenerator(words, this.definitions)\r\n    let density = 1\r\n    if (argv.density) {\r\n      density = parseFloat(argv.density)\r\n    }\r\n    if (isNaN(density)) {\r\n      console.log('density must be numeric in range > 0 density <= 1.0')\r\n      return\r\n    }\r\n\r\n    if (argv.script) {\r\n      await this.script(generator, density)\r\n    } else {\r\n      await this.single(generator, density)\r\n    }\r\n  }\r\n\r\n  private async single (generator: MessageGenerator, density: number) {\r\n    if (!argv.type) {\r\n      console.log('specify type to generate e.g. --type = AE')\r\n      return\r\n    }\r\n    const msgType: string = `${argv.type}`\r\n    let makeGroups: boolean = true\r\n    if (argv.groups) {\r\n      makeGroups = argv.groups === 'true'\r\n    }\r\n    const obj: ILooseObject = generator.generate(msgType, density, makeGroups)\r\n    console.log(JSON.stringify(obj, null, 4))\r\n    const fix: string = this.encodeObject(msgType, obj)\r\n    const ft: MsgTransport = new MsgTransport(1, this.session.config, new StringDuplex(fix))\r\n    if (argv.unit) {\r\n      await this.unitTest(fix, obj, ft)\r\n    } else {\r\n      this.subscribe(ft)\r\n    }\r\n  }\r\n\r\n  private async script (generator: MessageGenerator, density: number) {\r\n    let buffer: ElasticBuffer = new ElasticBuffer()\r\n    const repeats: number = argv.repeats || 50\r\n    const key: string = MsgTag.MsgType.toString()\r\n    const sf = this.definitions.simple.get(key)\r\n    const session: AsciiMsgTransmitter = this.session\r\n    for (let i = 0; i < repeats; ++i) {\r\n      const msgType: string = MessageGenerator.getRandomEnum(sf).toString()\r\n      console.log(`i = ${i} ${msgType}`)\r\n      const obj: ILooseObject = generator.generate(msgType, density)\r\n      session.encodeMessage(msgType, obj)\r\n      buffer.writeBuffer(session.buffer.slice())\r\n      buffer.writeString(require('os').EOL)\r\n    }\r\n    await JsfixCmd.writeFile('./fix.txt', buffer.slice().toString('utf8'))\r\n  }\r\n\r\n  private async unitTest (fix: string, obj: ILooseObject, ft: MsgTransport) {\r\n    const view: MsgView = await this.firstMessage(ft)\r\n    const summary = view.structure.summary()\r\n\r\n    await JsfixCmd.writeFile('./fix.txt', fix)\r\n    await JsfixCmd.writeFile('./object.json', JSON.stringify(obj, null, 4))\r\n    await JsfixCmd.writeFile('./token.txt', view.toString())\r\n    await JsfixCmd.writeFile('./structure.json', JSON.stringify(summary, null, 4))\r\n  }\r\n\r\n  private encodeObject (msgType: string, object: ILooseObject): string {\r\n    const session: AsciiMsgTransmitter = this.session\r\n    session.encodeMessage(msgType, object)\r\n    return session.buffer.toString()\r\n  }\r\n\r\n  private field (): void {\r\n    let sf: SimpleFieldDefinition\r\n    const tag: number = parseInt(argv.field, 10)\r\n    const definitions = this.definitions\r\n    if (!isNaN(tag)) {\r\n      sf = definitions.tagToSimple[tag]\r\n    } else {\r\n      sf = definitions.simple.get(argv.field)\r\n    }\r\n    if (sf) {\r\n      console.log(sf.toString())\r\n    }\r\n  }\r\n\r\n  ensureExists (path: string): Promise<any> {\r\n    return new Promise<any>((accept, reject) => {\r\n      fs.mkdirp(path, (err: Error) => {\r\n        if (err) {\r\n          reject(err)\r\n        } else {\r\n          accept()\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  private async compileDefinitions (outputPath: string) {\r\n    await this.ensureExists(path.join(outputPath, 'set'))\r\n    await this.ensureExists(path.join(outputPath, 'enum'))\r\n    const definitions = this.definitions\r\n    const compilerSettings: ICompilerSettings = require('../data/compiler.json')\r\n    compilerSettings.output = outputPath\r\n    const msgCompiler: MsgCompiler = new MsgCompiler(definitions, compilerSettings)\r\n    await msgCompiler.generate()\r\n    const enumCompiler: EnumCompiler = new EnumCompiler(definitions, compilerSettings)\r\n    const writeFile = path.join(compilerSettings.output, './enum/all-enum.ts')\r\n    await enumCompiler.generate(writeFile)\r\n  }\r\n\r\n  private async compile () {\r\n    let output = argv.output\r\n    const dp = getDictPath(argv.dict)\r\n    if (dp) {\r\n      output = dp.output\r\n    }\r\n    output = path.join(this.root, output)\r\n    await this.compileDefinitions(output)\r\n  }\r\n\r\n  private async init (): Promise<any> {\r\n    let session: string = argv.session || 'data/session/test-initiator.json'\r\n    session = this.norm(session)\r\n    this.sessionDescription = require(session)\r\n    let dict: string\r\n    if (argv.dict) {\r\n      dict = argv.dict\r\n    } else {\r\n      dict = this.sessionDescription.application.dictionary\r\n    }\r\n    this.definitions = await getDefinitions(dict)\r\n    const definitions = this.definitions\r\n    if (argv.delimiter) {\r\n      this.delimiter = AsciiChars.firstChar(argv.delimiter)\r\n    }\r\n    this.jsonHelper = new JsonHelper(definitions)\r\n    if (argv.session) {\r\n      const description = this.sessionDescription\r\n      const config = new JsFixConfig(new SessionMsgFactory(description), definitions, description, this.delimiter)\r\n      this.session = new AsciiMsgTransmitter(config)\r\n    }\r\n  }\r\n\r\n  private async dispatch (ft: MsgTransport): Promise<any> {\r\n    if (argv.type != null) {\r\n      this.filter = argv.type.toString()\r\n    }\r\n    let time: boolean = false\r\n    if (argv.time || argv.stats) {\r\n      this.print = false\r\n      time = true\r\n    }\r\n    this.subscribe(ft)\r\n    const startsAt: Date = new Date()\r\n    await ft.wait()\r\n    const elapsed: number = new Date().getTime() - startsAt.getTime()\r\n    if (time) {\r\n      console.log(`messages ${this.messages} elapsed ms ${elapsed}`)\r\n    }\r\n    if (argv.stats) {\r\n      console.log(JSON.stringify(this.stats, null, 4))\r\n    }\r\n  }\r\n\r\n  private subscribe (ft: MsgTransport) {\r\n    this.messages = 0\r\n    this.stats = {}\r\n    const filter = this.filter\r\n    // the receiver is message parser which is piped from an input stream - file, socket\r\n    ft.receiver.on('msg', (msgType: string, m: AsciiView) => {\r\n\r\n      if (filter) {\r\n        if (msgType !== filter) {\r\n          return\r\n        }\r\n      }\r\n      ++this.messages\r\n      this.onMsg(msgType, m)\r\n    })\r\n  }\r\n\r\n  private onMsg (msgType: string, m: MsgView) {\r\n    const mode: PrintMode = JsfixCmd.getPrintMode()\r\n    const print = this.print\r\n    const stats = this.stats\r\n    switch (mode) {\r\n      case PrintMode.Stats: {\r\n        if (!stats[msgType]) {\r\n          stats[msgType] = 1\r\n        } else {\r\n          stats[msgType] = stats[msgType] + 1\r\n        }\r\n        break\r\n      }\r\n\r\n      case PrintMode.Verbose: {\r\n        const verbose = m.toVerbose()\r\n        if (verbose) {\r\n          console.log(verbose)\r\n        }\r\n        break\r\n      }\r\n\r\n      case PrintMode.Object: {\r\n        const asObject: ILooseObject = m.toObject()\r\n        if (print) {\r\n          const def = this.definitions.message.get(msgType)\r\n          console.log(`${msgType} [${def.name}] = ${JSON.stringify(asObject, null, 4)}`)\r\n          console.log()\r\n        }\r\n        break\r\n      }\r\n\r\n      case PrintMode.Structure: {\r\n        const summary = m.structure.summary()\r\n        if (print) {\r\n          console.log(JSON.stringify(summary, null, 4))\r\n        }\r\n        break\r\n      }\r\n\r\n      case PrintMode.Token: {\r\n        const tokens = m.toString()\r\n        if (print) {\r\n          console.log(tokens)\r\n        }\r\n        break\r\n      }\r\n\r\n      case PrintMode.Encoded: {\r\n        const fix: string = this.encodeObject(msgType, m.toObject())\r\n        console.log(fix)\r\n        break\r\n      }\r\n\r\n      default:\r\n        throw new Error(`unknown mode ${mode}`)\r\n    }\r\n  }\r\n\r\n  private async replay (): Promise<any> {\r\n    if (!argv.fix) {\r\n      console.log('provide a path to fix file i.e. --fix=data/examples/execution-report/fix.txt')\r\n      return\r\n    }\r\n    const fix: string = this.norm(argv.fix)\r\n    const config = new JsFixConfig(null, this.definitions, this.sessionDescription, this.delimiter)\r\n    const ft: MsgTransport = new MsgTransport(1, config, new FileDuplex(fix))\r\n    await this.dispatch(ft)\r\n  }\r\n\r\n  private async benchmark (repeats: number): Promise<any> {\r\n    if (!argv.fix) {\r\n      console.log('provide a path to fix file i.e. --fix=data/examples/execution-report/fix.txt')\r\n      return\r\n    }\r\n    return new Promise<any>((accept, reject) => {\r\n      const fix: string = this.norm(argv.fix)\r\n      const fs = require('fs')\r\n      const definitions = this.definitions\r\n      const delimiter = this.delimiter\r\n      fs.readFile(fix, 'utf8', async (err: Error, contents: string) => {\r\n        if (err) {\r\n          reject(err)\r\n        }\r\n        const startsAt: Date = new Date()\r\n        let i = 0\r\n        const asciiParser: MsgParser = new AsciiParser(definitions, new StringDuplex(contents.repeat(repeats)).readable, delimiter)\r\n        asciiParser.on('msg', (msgType: string, v: MsgView) => {\r\n          ++i\r\n          if (i === repeats) {\r\n            const elapsed: number = new Date().getTime() - startsAt.getTime()\r\n            console.log(contents)\r\n            console.log(v.toString())\r\n            console.log(`[${msgType}]: repeats = ${repeats}, fields = ${v.structure.tags.nextTagPos}, length = ${contents.length} chars, elapsed ms ${elapsed}, ${(elapsed / repeats) * 1000} micros per msg`)\r\n            accept()\r\n          }\r\n        })\r\n      })\r\n    })\r\n  }\r\n\r\n  private encode (): void {\r\n    const session: AsciiMsgTransmitter = this.session\r\n    if (!session) {\r\n      console.log('provide a session json file e.g. --session=data/session/test-initiator.json')\r\n      return\r\n    }\r\n    if (!argv.type) {\r\n      console.log('provide a message type e.g. --type=8')\r\n      return\r\n    }\r\n    if (!argv.json) {\r\n      console.log('provide a json representation e.g. data/examples/execution-report/object.json')\r\n      return\r\n    }\r\n    const ts: string = argv.type.toString()\r\n    const msg: ILooseObject = this.jsonHelper.fromJson(path.join(this.root, argv.json), ts)\r\n    session.encodeMessage(ts, msg)\r\n    const fix: string = session.buffer.toString()\r\n    console.log(fix)\r\n  }\r\n\r\n  private norm (p: string): string {\r\n    let f: string = p\r\n    if (!path.isAbsolute(p)) {\r\n      f = path.join(this.root, f)\r\n    }\r\n    return f\r\n  }\r\n}\r\n\r\nfunction showHelp (): void {\r\n  console.log('this help page')\r\n  console.log('npm run cmd')\r\n  console.log('npm run cmd -- --help')\r\n  console.log()\r\n\r\n  console.log('token format i.e. [602] 687 (LegQty) = 33589')\r\n  console.log('jsfix-cmd --dict=data/FIX44.xml --fix=data/examples/quickfix/FIX.4.4/execution-report/fix.txt --delimiter=\"|\" --tokens')\r\n  console.log()\r\n\r\n  console.log('token format use fix repo dictionary')\r\n  console.log('jsfix-cmd --dict=data/fix_repo/FIX.4.4/Base --fix=data/examples/quickfix/FIX.4.4/execution-report/fix.txt'\r\n        + ' --delimiter=\"|\" --tokens')\r\n  console.log()\r\n\r\n  console.log('structure format i.e. show locations of components etc.')\r\n  console.log('jsfix-cmd --dict=data/FIX44.xml --fix=data/examples/FIX.4.4/quickfix/execution-report/fix.txt' +\r\n        ' --delimiter=\"|\" --tokens --structures')\r\n  console.log()\r\n\r\n  console.log('full JS object in JSON format.')\r\n  console.log('jsfix-cmd --dict=data/FIX44.xml --fix=data/examples/FIX.4.4/quickfix/execution-report/fix.txt' +\r\n        ' --delimiter=\"|\" --tokens --objects')\r\n  console.log()\r\n\r\n  console.log('full JS object in JSON format - filter only type messages.')\r\n  console.log('jsfix-cmd --dict=data/FIX44.xml --fix=data/examples/FIX.4.4/quickfix/execution-report/fix.txt' +\r\n        ' --delimiter=\"|\" --tokens --type=8 --objects')\r\n  console.log()\r\n\r\n  console.log('timing stats and message counts. Structured parsing of all messages.')\r\n  console.log('jsfix-cmd --dict=data/FIX44.xml --fix=data/examples/FIX.4.4/quickfix/execution-report/fix.txt --stats')\r\n  console.log()\r\n\r\n  console.log('encode a json object to fix format')\r\n  console.log('jsfix-cmd --json=data/examples/FIX.4.4/quickfix/execution-report/object.json' +\r\n        ' --session=data/session.json --type=8 --delimiter=\"|\"')\r\n  console.log()\r\n\r\n  console.log('display field definition')\r\n  console.log('jsfix-cmd --dict=data/FIX44.xml --field=MsgType|35')\r\n  console.log()\r\n\r\n  console.log('display field use fix repo dictionary e.g. 271 MDEntrySize QTY Quantity or volume represented by the Market Data Entry.')\r\n  console.log('jsfix-cmd --dict=data/fix_repo/FIX.4.4/Base --field=MsgType')\r\n  console.log('jsfix-cmd --dict=data/fix_repo/FIX.4.4/Base --field=35')\r\n  console.log()\r\n\r\n  console.log('script to describe field in repository version 4.4')\r\n  console.log('npm run repo44 -- --field=8')\r\n  console.log()\r\n\r\n  console.log('script to describe field in fixml')\r\n  console.log('npm run fixml -- --field=50')\r\n  console.log()\r\n\r\n  console.log('generate unit test set of files - i.e. randomly generate an object, encode to fix. density 1 is all fields')\r\n  console.log('jsfix-cmd --generate --type=AE --density=0.8 --unit --delimiter=\"|\" --session=data/session/test-initiator.json')\r\n  console.log('npm run repo44-unit -- --type=AE')\r\n  console.log('test script with no repeat groups')\r\n  console.log('npm run repo44-unit -- --type=AE --groups=false')\r\n  console.log()\r\n\r\n  console.log('generate a fix log of randomly generated but syntactically correct messages')\r\n  console.log('jsfix-cmd --generate --density=0.8 --repeats=50 --script --delimiter=\"|\" --session=data/session/test-initiator.json')\r\n  console.log('npm run repo44-script')\r\n  console.log('parse above generated script')\r\n  console.log('npm run repo44-repscr')\r\n  console.log()\r\n\r\n  console.log('replay example repo fix file of 50 messages.')\r\n  console.log('jsfix-cmd --session=data/session/test-initiator.json --fix=data/examples/FIX.4.4/fix.txt --delimiter=\"|\" --stats')\r\n  console.log('npm run repo44-replay -- --stats')\r\n  console.log('npm run repo44-replay -- --objects')\r\n  console.log('npm run repo44-replay -- --tokens')\r\n  console.log('npm run repo44-replay -- --structures')\r\n  console.log()\r\n\r\n  console.log('benchmark parse a message')\r\n  console.log('jsfix-cmd --delimiter=\"|\" --session=data/session/test-initiator.json --fix=data/examples/FIX.4.4/repo/trade-capture-no-groups/fix.txt --benchmark')\r\n  console.log('npm run repo44-bench -- --fix=data/examples/FIX.4.4/repo/trade-capture-no-groups/fix.txt')\r\n  console.log()\r\n\r\n  console.log('compile typescript interfaces - i.e. outputs to src/types/FIX4.4 - requires set and enum sub folders')\r\n  console.log('npm run cmd -- --dict=repo40 --compile')\r\n  console.log('npm run cmd -- --dict=repo41 --compile')\r\n  console.log('npm run cmd -- --dict=repo42 --compile')\r\n  console.log('npm run cmd -- --dict=repo43 --compile')\r\n  console.log('npm run cmd -- --dict=repo44 --compile')\r\n  console.log('npm run cmd -- --dict=repo50 --compile')\r\n  console.log('npm run cmd -- --dict=repo50sp1 --compile')\r\n  console.log('npm run cmd -- --dict=repo50sp2 --compile')\r\n  console.log('npm run cmd -- --dict=repofixml --compile')\r\n  console.log('npm run cmd -- --dict=qf44 --compile')\r\n  console.log('npm run cmd -- --dict=data/handmade.xml --compile --output=src/types/handmade')\r\n\r\n  console.log()\r\n}\r\n\r\nconst help: boolean = argv.h || argv.help\r\nif (help) {\r\n  showHelp()\r\n} else {\r\n  const cmd: JsfixCmd = new JsfixCmd()\r\n  cmd.exec().then((res: boolean) => {\r\n    if (!res) {\r\n      showHelp()\r\n    }\r\n  }).catch((e: Error) => {\r\n    console.log(`error ${e.message}`)\r\n  })\r\n}\r\n"]}